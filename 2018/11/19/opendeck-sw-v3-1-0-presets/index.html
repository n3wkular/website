<!DOCTYPE html > <html lang="en-US"> <!-- Site Head --> <head> <meta charset="utf-8"> <title>OpenDeck software v3.1.0 - Presets</title> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="shortcut icon" href="/images/favicon.png" title="Favicon"> <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet"> <!-- Importing Styles --> <link rel="stylesheet" href="/css/style.css"> <style> .markdown-body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 auto;
      padding: 45px;
    }
  
    @media (max-width: 767px) {
      .markdown-body {
        padding: 15px;
      }
    } </style> </head> <body> <!-- Page Loader --> <div id="page-loader" class="page-loader"><span class="load-icon"></span></div> <!-- Site Header --> <header class="site-header blog-header parallax" id="home" data-scrollax-parent="true"> <!-- Parallax Header Image --> <div class="parallax-wrapper"> <div class="cover" data-scrollax="properties: { 'translateY': '48%' }"> <img style="min-width: 100%;" src="/images/blog/header.jpg"> </div> </div> <div class="container"> <!-- Site Navigation Bar --> <div class="row site-navigation-bar parent"> <!-- Logo --> <div class="col-sm-2 col-xs-4 logo child-center-v"> <a href="/index.html"><img src="/images/logo_notext.svg" width="70"></a> </div> <!-- Toggle Mobile Menu --> <div class="col-xs-8 toggle-menu child-center-v"> <!-- Burger --> <div class="navTrigger"> <i></i><i></i><i></i> </div> </div> <!-- Navigation Bar --> <div class="col-sm-10 col-xs-12 navigation-bar child-center-v"> <!-- Navigation Menu --> <nav id="navMenu" class="nav-menu"> <ul class="menu"> <li><a href="/#about">ABOUT</a></li> <li><a href="/#features">FEATURES</a></li> <li><a href="/#parallax-features">SPECS</a></li> <li><a href="/#portfolio">GALLERY</a></li> <li><a href="/#testimonials">TESTIMONIALS</a></li> <li class="current-menu-item"><a href="/blog">BLOG</a></li> <li><a href="/#prices">OFFERS</a></li> <li><a href="/#contact">CONTACT</a></li> </ul> </nav> </div> </div> <!-- Site Header Banner --> <div class="row header-banner parent" data-scrollax="properties: { 'translateY': '48%', 'opacity': '1.4' }"> <div class="heading-content text-center child-center-v"> <!-- Heading Title --> <div class="row heading-title"> <h2>Shantea Controls</h2> <hr class="small"> <h1 class="thin">OpenDeck software v3.1.0 - Presets</h1> </div> </div> </div> </div> </header> <!-- Page Section --> <section class="site-section blog-section page-layout" id="start"> <div class="container"> <!-- Page Layout --> <div class="row"> <!-- Sidebar --> <div class="col-md-4 hidden-xs hidden-sm"> <!-- Site Sidebar --> <aside class="site-sidebar"> <!-- Categories Widget --> <div class="widget categories-widget"> <!-- Widget Header --> <header class="widget-header"> <h4 class="widget-title">Categories</h4> </header> <!-- Widget Content --> <div class="widget-content"> <ul class="categories-box"> <li><a href="/category/info">info <span class="cat-count">8</span></a></li> <li><a href="/category/design">design <span class="cat-count">7</span></a></li> <li><a href="/category/build-log">build-log <span class="cat-count">9</span></a></li> <li><a href="/category/development">development <span class="cat-count">20</span></a></li> <li><a href="/category/programming">programming <span class="cat-count">5</span></a></li> </ul> </div> </div> </aside> </div> <!-- Content --> <div class="col-md-8 blog-articles-container"> <!-- Blog Article --> <div class="post-full"> <article class="blog-article blog-single-page clearfix"> <!-- Article Header --> <header class="article-header"> <div class="img-wrap"> <img src="/images/blog/43b3a-presets_global.png" alt="Article Blog Image"> </div> </header> <!-- Article Content --> <article class="markdown-body"> <p><strong>Presets</strong> are one of features I’ve been asked the most about. In this post I’ll talk about the implementation of presets in OpenDeck software.</p> <h2 id="implementation">Implementation</h2> <p>If you don’t care about the implementation feel free to just skip to next section!</p> <p>Since the first version of OpenDeck, database (configuration) has been split into blocks and sections. Block is a logical unit unit of data containing one or more sections. I’ve created library to handle this, <a href="https://github.com/paradajz/LESS-DB">available on GitHub</a>. For instance, blocks on OpenDeck are buttons, LEDs, encoders etc. Entire structure is listed in <a href="https://github.com/paradajz/OpenDeck/blob/c0bfd5140d82772d80c347d660f1cf06937b8c57/src/application/database/Layout.cpp">Layout database file</a>. If we take button block for example, some of the sections it contains are MIDI channel, MIDI message, type etc. To read or write to database in the OpenDeck software, block, section and index are the required parameters. Example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>database.read(DB_BLOCK_ANALOG, dbSection_analog_lowerLimit, analogID);
database.update(DB_BLOCK_ANALOG, dbSection_analog_lowerLimit, analogID, 127);
</code></pre></div></div> <p>This means that it’s really easy to access parameters in OpenDeck database without knowing the low-level details, such as how the database is accessed or what the address of the parameter really is. Library handles this.</p> <p>One of the goals when I was implementing the presets was to introduce minimum amount of changes to code. Basically, I wanted to retain the same read/write API as it is now.</p> <p>To implement presets, I needed to copy entire configuration to another address, that is, the last address of the previous preset, since the software calculates the size needed dynamically, and therefore, number of supported presets is calculated dynamically as well. No need for hardcoding! Setting the start address in memory was the only required addition to database-handling library in order for this to work, so when preset is changed, only thing that actually changes is that database reads/writes data starting from specified address.</p> <p>On the top/start of the database is something called system block, which is just another database block, but the one not accessible to user. This block contains preset settings and database signature, which is checked in initialization phase. If the signature isn’t correct, factory reset is performed. Changing the preset in the software is done by calling <code class="language-plaintext highlighter-rouge">Database::setPreset()</code> function, which simply sets new start address in the database, so the example call above remains the same - the data is read from another preset and read/write API isn’t disrupted. Entire implementation is available <a href="https://github.com/paradajz/OpenDeck/blob/master/src/application/database/Database.cpp">here</a>.</p> <h2 id="options">Options</h2> <p>Preset options are now located in “Global” section in the OpenDeck web configuration tool. MIDI settings are here as well. One word of caution: since the MIDI settings now share the configuration screen with presets, this means that any OpenDeck board with the software before v3.1.0. won’t be able to configure the MIDI settings via the configuration tool. This is because the tool will ask the board for information about the presets which older firmware knows nothing about, so the tool will just throw bunch of errors in the activity section. I really wish the tool didn’t behave like this, but since I haven’t wrote it, I can’t really change the underlying logic how it works as I don’t understand it at all. I’d be really happy if someone could take maintenance of the tool, since it’s merged to OpenDeck GitHub repository.</p> <p>Anyways, there are only two new options with the introduction of the presets: the active preset and preset preservation.</p> <p><img src="/images/blog/43b3a-presets_global.png" alt=""></p> <p>Active preset switches the active preset (doh!). Preset preservation controls whether or not the selected preset will be remembered once the board reboots. This is disabled by default, so the board will always start in preset 1. Using the toggle that behavior can be changed.</p> <p>I’ve made sure there are lots of ways the preset can be changed. As mentioned above, preset can be changed simply in the configuration tool.</p> <p>In the tool, any button can be assigned to preset change function.</p> <p><img src="/images/blog/8bedb-presets_button.png" alt=""></p> <p>If the button is set to change the preset, MIDI ID parameter is used to set the preset, so if MIDI ID is 2, 3rd preset will be set on once the button is pressed (0 is first preset).</p> <p>Preset can also be changed with encoder.</p> <p><img src="/images/blog/cdceb-presets_encoder.png" alt=""></p> <p>There is one caveat when using buttons or encoders to change the preset. In order for this to work fully as expected, buttons and encoders intended to change the preset need to be configured in each preset, which may not be obvious at first. Think about it. Preset is entire configuration copy. If you configure the button to switch to preset 2, preset 2 is in default state initially (on fresh board or after factory reset), which means that same button will send usual MIDI message in that preset.</p> <p>Another way preset can be changed is by sending MIDI program change message via DIN MIDI or USB MIDI to the board.</p> <p>One final thing - LEDs can be configured to indicate the currently active preset! Simply set their control type to Local - Program change (when using buttons or encoders on board to change the preset) or MIDI In - Program change (if using USB MIDI to change the preset) and set the activation ID to preset number you want to indicate (again, numbering starts from 0). The same caveat as for buttons and encoders applies here - make sure to configure the LEDs for preset indication in every preset!</p> <h2 id="bad-news">Bad news</h2> <p>I need to mention that the presets aren’t supported on official OpenDeck board, unfortunately. They are supported on every other OpenDeck-enabled board (Arduino Uno, Arduino Pro Micro, Arduino Leonardo, Arduino Mega and Teensy++ 2.0). The reason for this is that OpenDeck board lacks the EEPROM memory required for multiple presets, which is a shame. This will be improved on the next major OpenDeck board redesign in which I’ll switch to different MCU.</p> </article> <!-- Article Tool Boxes --> <div class="article-boxes"> <!-- Tags Box --> <div class="tags-article box"> <span class="title">Tags:</span> <ul class="tag-cloud-box box-content"> <li><a href="/tag/midi">midi</a></li> <li><a href="/tag/opendeck">opendeck</a></li> <li><a href="/tag/presets">presets</a></li> <li><a href="/tag/webmidi">webmidi</a></li> </ul> </div> <div id="hyvor-talk-view"></div> <script type="text/javascript"> var HYVOR_TALK_WEBSITE = 4484;
          var HYVOR_TALK_CONFIG = {
            url: 'https://shanteacontrols.com/2018/11/19/opendeck-sw-v3-1-0-presets/',
            id: '/2018/11/19/opendeck-sw-v3-1-0-presets/'
          }; </script> <script async type="text/javascript" src="//talk.hyvor.com/web-api/embed"></script> </div> </article> </div> </div> </div> </div> </section> <!-- Site Footer --> <footer class="site-footer" id="footer"> <div class="container"> <div class="row"> <div class="col-md-6 col-md-push-3 footer-info text-center"> <div class="footer-logo"> <img src="/images/logo.svg" width="700"> </div> <div class="footer-info-text"> <p></p> </div> <div class="social-icons"> <ul class="icons"> <li><a href="https://youtube.com/shanteacontrols" target="_blank"><i class="fi flaticon-youtube"></i></a></li> <li><a href="https://www.facebook.com/shanteacontrolsmidi" target="_blank"><i class="fi flaticon-facebook"></i></a></li> </ul> </div> </div> <div class="col-md-8 col-md-push-2 footer-copyright"> <div class="footer-text text-center"> <p>All Rights Reserved</p> <p><a href="https://shanteacontrols.com/">Shantea Controls</a> &copy; 2021</p> </div> </div> </div> </div> </footer> <!-- Go To Top Button --> <a href="#home" class="go-to-top-button"><i class="pe-7s-angle-up"></i></a> <!-- Importing Scripts --> <!-- jQuery CDN --> <script src="//ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script> <!-- If CDN fails than use local jQuery --> <script>window.jQuery || document.write('<script src="/js/jquery-3.0.0.min.js"><\/script>')</script> <!-- Owl Carousel --> <script src="/js/carousel.min.js" charset="utf-8"></script> <!-- Parallaxing & SmoothScroll --> <script src="/js/scrollax.min.js" charset="utf-8"></script> <!-- Main JS --> <script src="/js/main.js" charset="utf-8"></script> </body> </html> 