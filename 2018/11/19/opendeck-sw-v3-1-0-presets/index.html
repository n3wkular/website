<!DOCTYPE html> <html lang="zxx"> <head> <!-- meta --> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="description" content=""> <meta name="keywords" content=""> <!-- Facebook Open Graph --> <meta content="Shantea Controls" property="og:site_name"> <meta property="og:locale" content="en_US"> <meta content="OpenDeck software v3.1.0 - Presets" property="og:title"> <meta content="article" property="og:type"> <meta content="" property="og:description"> <meta content="https://shanteacontrols.com/2018/11/19/opendeck-sw-v3-1-0-presets/" property="og:url"> <meta content="43b3a-presets_global.png" property="og:image"> <meta content="midi" property="article:tag"> <meta content="opendeck" property="article:tag"> <meta content="presets" property="article:tag"> <meta content="webmidi" property="article:tag"> <meta content="development" property="article:section"> <meta content="2018-11-19T00:00:00+00:00" property="article:published_time"> <!-- Twitter cards --> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="OpenDeck software v3.1.0 - Presets"> <meta name="twitter:description" content=""> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://shanteacontrols.com43b3a-presets_global.png"> <!-- Site Title --> <title> OpenDeck software v3.1.0 - Presets </title> <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon"> <!-- gulp:css --> <link rel="stylesheet" href="/css/blog/app.css"> <!-- endgulp --> <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600" rel="stylesheet"> </head> <nav class="navbar navbar-default fixed-top"> <div class="container-fluid"> <div class="navbar-header"> <a href="/blog/blog.html"> <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/> <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/> </svg> </a>  </div> </div> </nav> <body class="post-template"> <div class="page-header grey-bg mt-5 pb-100 mb-100 pt-85 clearfix"> <div class="container"> <div class="row"> <div class="col"> <div class="author-text"> <div class="single-author-d w-100"> <div class="title"> <h2 class="mb-0 text-center">OpenDeck software v3.1.0 - Presets</h2> </div> <div class="post-meta d-flex"> <ul class="post-sp-meta list-inline mx-auto my-0"> <li class="list-inline-item"> <i class="fa fa-clock-o"></i>19 November 2018 </li> </ul> </div> </div> </div> </div> </div> </div> </div> <div class="post-content-area pb-100 clearfix"> <div class="container"> <div class="row"> <div class="col-lg-10 mx-auto"> <div class="s-post-details"> <div class="post-image mb-4"> <img class="mx-auto d-block" src="/images/blog/43b3a-presets_global.png" alt="OpenDeck software v3.1.0 - Presets"> </div> <div class="entry-content"><p><strong>Presets</strong> are one of features I’ve been asked the most about. In this post I’ll talk about the implementation of presets in OpenDeck software.</p> <h2 id="implementation">Implementation</h2> <p>If you don’t care about the implementation feel free to just skip to next section!</p> <p>Since the first version of OpenDeck, database (configuration) has been split into blocks and sections. Block is a logical unit unit of data containing one or more sections. I’ve created library to handle this, <a href="https://github.com/shanteacontrols/LESS-DB">available on GitHub</a>. For instance, blocks on OpenDeck are buttons, LEDs, encoders etc. Entire structure is listed in <a href="https://github.com/shanteacontrols/OpenDeck/blob/c0bfd5140d82772d80c347d660f1cf06937b8c57/src/application/database/Layout.cpp">Layout database file</a>. If we take button block for example, some of the sections it contains are MIDI channel, MIDI message, type etc. To read or write to database in the OpenDeck software, block, section and index are the required parameters. Example:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>database.read(DB_BLOCK_ANALOG, dbSection_analog_lowerLimit, analogID);
database.update(DB_BLOCK_ANALOG, dbSection_analog_lowerLimit, analogID, 127);
</code></pre></div></div> <p>This means that it’s really easy to access parameters in OpenDeck database without knowing the low-level details, such as how the database is accessed or what the address of the parameter really is. Library handles this.</p> <p>One of the goals when I was implementing the presets was to introduce minimum amount of changes to code. Basically, I wanted to retain the same read/write API as it is now.</p> <p>To implement presets, I needed to copy entire configuration to another address, that is, the last address of the previous preset, since the software calculates the size needed dynamically, and therefore, number of supported presets is calculated dynamically as well. No need for hardcoding! Setting the start address in memory was the only required addition to database-handling library in order for this to work, so when preset is changed, only thing that actually changes is that database reads/writes data starting from specified address.</p> <p>On the top/start of the database is something called system block, which is just another database block, but the one not accessible to user. This block contains preset settings and database signature, which is checked in initialization phase. If the signature isn’t correct, factory reset is performed. Changing the preset in the software is done by calling <code class="language-plaintext highlighter-rouge">Database::setPreset()</code> function, which simply sets new start address in the database, so the example call above remains the same - the data is read from another preset and read/write API isn’t disrupted. Entire implementation is available <a href="https://github.com/shanteacontrols/OpenDeck/blob/master/src/application/database/Database.cpp">here</a>.</p> <h2 id="options">Options</h2> <p>Preset options are now located in “Global” section in the OpenDeck web configuration tool. MIDI settings are here as well. One word of caution: since the MIDI settings now share the configuration screen with presets, this means that any OpenDeck board with the software before v3.1.0. won’t be able to configure the MIDI settings via the configuration tool. This is because the tool will ask the board for information about the presets which older firmware knows nothing about, so the tool will just throw bunch of errors in the activity section. I really wish the tool didn’t behave like this, but since I haven’t wrote it, I can’t really change the underlying logic how it works as I don’t understand it at all. I’d be really happy if someone could take maintenance of the tool, since it’s merged to OpenDeck GitHub repository.</p> <p>Anyways, there are only two new options with the introduction of the presets: the active preset and preset preservation.</p> <p><img src="/images/blog/43b3a-presets_global.png" alt=""></p> <p>Active preset switches the active preset (doh!). Preset preservation controls whether or not the selected preset will be remembered once the board reboots. This is disabled by default, so the board will always start in preset 1. Using the toggle that behavior can be changed.</p> <p>I’ve made sure there are lots of ways the preset can be changed. As mentioned above, preset can be changed simply in the configuration tool.</p> <p>In the tool, any button can be assigned to preset change function.</p> <p><img src="/images/blog/8bedb-presets_button.png" alt=""></p> <p>If the button is set to change the preset, MIDI ID parameter is used to set the preset, so if MIDI ID is 2, 3rd preset will be set on once the button is pressed (0 is first preset).</p> <p>Preset can also be changed with encoder.</p> <p><img src="/images/blog/cdceb-presets_encoder.png" alt=""></p> <p>There is one caveat when using buttons or encoders to change the preset. In order for this to work fully as expected, buttons and encoders intended to change the preset need to be configured in each preset, which may not be obvious at first. Think about it. Preset is entire configuration copy. If you configure the button to switch to preset 2, preset 2 is in default state initially (on fresh board or after factory reset), which means that same button will send usual MIDI message in that preset.</p> <p>Another way preset can be changed is by sending MIDI program change message via DIN MIDI or USB MIDI to the board.</p> <p>One final thing - LEDs can be configured to indicate the currently active preset! Simply set their control type to Local - Program change (when using buttons or encoders on board to change the preset) or MIDI In - Program change (if using USB MIDI to change the preset) and set the activation ID to preset number you want to indicate (again, numbering starts from 0). The same caveat as for buttons and encoders applies here - make sure to configure the LEDs for preset indication in every preset!</p> <h2 id="bad-news">Bad news</h2> <p>I need to mention that the presets aren’t supported on official OpenDeck board, unfortunately. They are supported on every other OpenDeck-enabled board (Arduino Uno, Arduino Pro Micro, Arduino Leonardo, Arduino Mega and Teensy++ 2.0). The reason for this is that OpenDeck board lacks the EEPROM memory required for multiple presets, which is a shame. This will be improved on the next major OpenDeck board redesign in which I’ll switch to different MCU.</p> </div> <div class="inner-padding fullwidth pb-60"> <div class="post-share-icon clearfix"> <div class="tag-list"> <div class="row"> <div class="col-md-8"> <p class="float-left pr-2"><strong>Tags :</strong></p> <ul class="float-left"> <li> <a href="/tag/midi/blog.html"> #midi</a> </li> <li> <a href="/tag/opendeck/blog.html"> #opendeck</a> </li> <li> <a href="/tag/presets/blog.html"> #presets</a> </li> <li> <a href="/tag/webmidi/blog.html"> #webmidi</a> </li> </ul> </div> <div class="col-md-4"></div> </div> </div> </div> </div> </div> <div class="categories-carousel pb-60 clearfix"> <div class="section-title"> <h3>Related Posts</h3> </div> <div class="related-post-carousel owl-carousel"> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/cover_opendeck_v6.jpg" alt="OpenDeck v6 - what comes next?"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2021/11/23/opendeck-6-what-comes-next/">OpenDeck v6 - what comes next? <span class="label label-default">opendeck</span> </a> </h3> <div class="btn-read"> <a href="/2021/11/23/opendeck-6-what-comes-next/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/IMG_3135_web.jpg" alt="New firmware, new boards, new controllers"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2020/10/12/new-firmware-new-boards-new-controllers/">New firmware, new boards, new controllers <span class="label label-default">opendeck</span> </a> </h3> <div class="btn-read"> <a href="/2020/10/12/new-firmware-new-boards-new-controllers/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/stm32f4discovery.jpg" alt="OpenDeck on ARM"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2020/02/27/opendeck-on-arm/">OpenDeck on ARM <span class="label label-default">opendeck</span> </a> </h3> <div class="btn-read"> <a href="/2020/02/27/opendeck-on-arm/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/webui-9.png" alt="Looking for a Web developer"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2020/02/16/looking-for-a-web-developer/">Looking for a Web developer <span class="label label-default">opendeck</span> </a> </h3> <div class="btn-read"> <a href="/2020/02/16/looking-for-a-web-developer/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/98b26-bergamot_full_angle.jpg" alt="Touchscreen-based MIDI controller"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2018/10/14/bergamot-touchscreen-midi-controller/">Touchscreen-based MIDI controller <span class="label label-default">midi</span> <span class="label label-default">opendeck</span> </a> </h3> <div class="btn-read"> <a href="/2018/10/14/bergamot-touchscreen-midi-controller/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/post_default_header.jpg" alt="OpenDeck software v2.1.1"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2018/08/22/opendeck-software-v2-1-1/">OpenDeck software v2.1.1 <span class="label label-default">opendeck</span> </a> </h3> <div class="btn-read"> <a href="/2018/08/22/opendeck-software-v2-1-1/">Read More</a> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> <footer> <div class="footer-area clearfix"> <div class="container"> <div class="row"> <div class="col-lg-12"> <div class="footer-logo pb-100 pt-100 text-center"> <a href="https://shanteacontrols.com"> <img src="/images/logo_notext_inv.svg" alt="Shantea Controls"> </a> </div> </div> </div> <div class="row pb-60"> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4> About </h4> </div> <div class="widget-text"> <p>Shantea Controls Blog</p> <div class="social-link"> <ul> </ul> </div> </div> </div> </div> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4>Recent posts</h4> </div> <div class="widget-text"> <div class="r-post"> <ul> <li><a href="/2021/11/23/opendeck-6-what-comes-next/">OpenDeck v6 - what comes next? </a> </li> <li><a href="/2021/06/04/the-new-dubfocus-controller/">The new DubFocus controller </a> </li> <li><a href="/2021/03/30/regarding-dubfocus/">Regarding DubFocus </a> </li> <li><a href="/2021/02/18/the-touchscreen-trio/">The touchscreen trio </a> </li> </ul> </div> </div> </div> </div> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4> Links</h4> </div> <div class="widget-text"> <div class="widget-link"> <ul> <ul> <li><a href="/" target="_blank">Main page</a></li> <li><a href="https://youtube.com/shanteacontrols" target="_blank">YouTube</a></li> <li><a href="https://www.facebook.com/shanteacontrolsmidi" target="_blank">Facebook</a></li> <li><a href="https://github.com/shanteacontrols/OpenDeck" target="_blank">GitHub</a></li> </ul> </ul></div> </div> </div> </div> </div> <div class="row"> <div class="col"> <div class="footer-text text-center"> <p class="footer-address"> &copy; 2022 Shantea Controls | Developed by <a href="https://themeix.com">themeix</a></p> </div> </div> </div> </div> </div> </footer> <script src="/js/blog/build.js"></script> </body> </html> 