<!DOCTYPE html > <html lang="en-US"> <!-- Site Head --> <head> <meta charset="utf-8"> <title>OpenDeck SysEx protocol - stable!</title> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="shortcut icon" href="/images/favicon.png" title="Favicon"> <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet"> <!-- Importing Styles --> <link rel="stylesheet" href="/css/style.css"> </head> <body> <!-- Page Loader --> <div id="page-loader" class="page-loader"><span class="load-icon"></span></div> <!-- Site Header --> <header class="site-header blog-header parallax" id="home" data-scrollax-parent="true"> <!-- Parallax Header Image --> <div class="parallax-wrapper"> <div class="cover" data-scrollax="properties: { 'translateY': '48%' }"> <img style="min-width: 100%;" src="/images/blog/header.jpg"> </div> </div> <div class="container"> <!-- Site Navigation Bar --> <div class="row site-navigation-bar parent"> <!-- Logo --> <div class="col-sm-2 col-xs-4 logo child-center-v"> <a href="/index.html"><img src="/images/logo_notext.svg" width="70"></a> </div> <!-- Toggle Mobile Menu --> <div class="col-xs-8 toggle-menu child-center-v"> <!-- Burger --> <div class="navTrigger"> <i></i><i></i><i></i> </div> </div> <!-- Navigation Bar --> <div class="col-sm-10 col-xs-12 navigation-bar child-center-v"> <!-- Navigation Menu --> <nav id="navMenu" class="nav-menu"> <ul class="menu"> <li><a href="/#about">ABOUT</a></li> <li><a href="/#features">FEATURES</a></li> <li><a href="/#portfolio">GALLERY</a></li> <li><a href="/#testimonials">TESTIMONIALS</a></li> <li class="current-menu-item"><a href="/#blog">BLOG</a></li> <li><a href="/#prices">OFFERS</a></li> <li><a href="/#contact">CONTACT</a></li> </ul> </nav> </div> </div> <!-- Site Header Banner --> <div class="row header-banner parent" data-scrollax="properties: { 'translateY': '48%', 'opacity': '1.4' }"> <div class="heading-content text-center child-center-v"> <!-- Heading Title --> <div class="row heading-title"> <h2>Shantea Controls</h2> <hr class="small"> <h1 class="thin">OpenDeck SysEx protocol - stable!</h1> </div> </div> </div> </div> </header> <!-- Page Section --> <section class="site-section blog-section page-layout" id="start"> <div class="container"> <!-- Page Layout --> <div class="row"> <!-- Sidebar --> <div class="col-md-4 hidden-xs hidden-sm"> <!-- Site Sidebar --> <aside class="site-sidebar"> <!-- Categories Widget --> <div class="widget categories-widget"> <!-- Widget Header --> <header class="widget-header"> <h4 class="widget-title">Categories</h4> </header> <!-- Widget Content --> <div class="widget-content"> <ul class="categories-box"> <li><a href="/category/info">info <span class="cat-count">8</span></a></li> <li><a href="/category/design">design <span class="cat-count">7</span></a></li> <li><a href="/category/build-log">build-log <span class="cat-count">9</span></a></li> <li><a href="/category/development">development <span class="cat-count">20</span></a></li> <li><a href="/category/programming">programming <span class="cat-count">5</span></a></li> </ul> </div> </div> </aside> </div> <!-- Content --> <div class="col-md-8 blog-articles-container"> <!-- Blog Article --> <div class="post-full"> <article class="blog-article blog-single-page clearfix"> <!-- Article Header --> <header class="article-header"> <div class="img-wrap"> <img src="/images/blog/post_default_header.jpg" alt="Article Blog Image"> </div> </header> <!-- Article Content --> <div class="article-content"> <p>Last time I wrote about OpenDeck SysEx protocol, there were still many unsolved problems and issues, together with lack of functionality. Since I actually released OpenDeck software on GitHub couple of days ago, it’s time to write a new post, explaining all current features, and announcing some new ones.</p> <h2 id="hello-world">Hello World</h2> <p>Back when I first wrote about SysEx protocol, I explained how SysEx programming doesn’t work until “Hello World” message has been received. That bit wasn’t implemented then, but it is now. Hello message consists of three ID bytes only (hex code):</p> <p><strong>F0 00 53 43 F7</strong></p> <p>After the message is sent to controller, it responds with those same ID bytes, and ACK at the end (0x41).</p> <p><strong>F0 00 53 43 41 F7</strong></p> <p>When this message is received, controller can be programmed using System Exclusive.</p> <h2 id="message-format">Message format</h2> <p>Main message format for SysEx is left untouched, as it proved efficient and reasonably easy to use:</p> <p><strong>F0 ID ID ID WISH AMOUNT MESSAGE_TYPE MESSAGE_SUBTYPE PARAMETER_ID* NEW_PARAMETER_ID* F7</strong></p> <p>Bytes marked with asterisk are optional, since their use depends on WISH and AMOUNT bytes.</p> <h1 id="message-types">Message types</h1> <p>Since last post, only thing changed here are MESSAGE_TYPE codes:</p> <ul> <li>SYS_EX_MT_MIDI_CHANNEL</li> <li>SYS_EX_MT_HW_PARAMETER</li> <li>SYS_EX_MT_FREE_PINS,</li> <li>SYS_EX_MT_SW_FEATURE</li> <li>SYS_EX_MT_HW_FEATURE</li> <li>SYS_EX_MT_BUTTON</li> <li>SYS_EX_MT_POT</li> <li>SYS_EX_MT_ENC</li> <li>SYS_EX_MT_LED</li> <li>SYS_EX_MT_ALL</li> </ul> <p>MIDI channel has code 0, HW parameter 1, and every next byte has next incremented value.</p> <h2 id="additions">Additions</h2> <p>Pots now have additional sub-types: lower and upper CC limit. Using those message, each pot can have defined CC range. After you define custom range, ie. 40-120, CC message won’t be “cut-off”, it will be interpolated across whole pot range instead.</p> <p>Another addition from last time is the “Free pins” message, that is, you can now configure those four free pins available on reference PCB. Due to the mistake in design, pin C can only be configured as output, since it’s connected to pin 13 on Arduino. It has nothing to do with pin 13 itself, it’s just the fact that pretty much every Arduino out there has LED and resistor connected to that pin, so using it as input is harder, but not impossible. It would require usage of some extra components, but for convenience sake I’ve decided that it can only be configured as output. Because of that, you cannot increase number of inputs to 64 (four extra rows in button matrix), but 56 instead. No big deal, but I’ll most certainly pick another pin for user configuration on next PCB design.</p> <p>Example of free pin configuration:</p> <p>Let’s set pin A as output, which will result in increase of maximum number of LEDs to 40:</p> <p><strong>F0 00 53 43 01 00 02 00 00 02 F7</strong></p> <p>F0 is usual SysEx message start, followed by three ID bytes. We want to configure (set) pin, so WISH byte is 01. Since we only want to set one pin, amount it 0 (single). Message type for free pin message is 02, with no sub-type. Pin A parameter code is 00, and since we want to set it as output, new parameter code is 02. Setting it to 0 disables it, and setting it to 1 would configure that pin as extra button row.</p> <p>Response from the controller is the following message:</p> <p><strong>F0 00 53 43 01 00 02 00 41 F7</strong></p> <p>Response has been also re-modeled a bit since last time. It copies everything from the original message, except the parameter and new parameter (if message wish is set, that is). It also places ACK (0x41) on the end of message, so that it’s easier to notice if the message has been handled properly.</p> <h2 id="data-restoration">Data restoration</h2> <p>Data restoration is now possible as well. You can use it to restore single parameter, all parameters within message type or everything back to default.</p> <p>Some examples of restoration:</p> <p>Setting button channel back to default (1): <strong>F0 00 53 43 02 00 00 00 00 F7</strong></p> <p>Setting all channels to default: <strong>F0 00 53 43 02 01 00 00 F7</strong></p> <p>Setting all pots to their default state (disabled): <strong>F0 00 53 43 02 01 06 00 F7</strong></p> <p>Complete factory reset: <strong>F0 00 53 43 02 01 09 00 F7</strong></p> <p>If entire controller is restored to defaults, first thing that needs to be configured is board type. Board type for OpenDeck reference board is 01, and you need to set it using the following message:</p> <p><strong>F0 00 53 43 01 00 01 00 00 01 F7</strong></p> <h2 id="led-configuration">LED configuration</h2> <p>LEDs configuration is another thing that still wasn’t possible when I wrote first SysEx post. LEDs now have several sub-types of message:</p> <ul> <li>SYS_EX_MST_LED_ACT_NOTE</li> <li>SYS_EX_MST_LED_START_UP_NUMBER</li> <li>SYS_EX_MST_LED_STATE</li> </ul> <p>Again, LED_ACT_NOTE has code 0, START_UP_NUMBER is 1, and LED_STATE is 2. Using the first subtype it’s possible to select which MIDI note will turn on or off the LED. Start-up number is used only during the start-up routine. Since that routine deals with LEDs one-by-one, you can use that message sub-type to use any LED order you want. LED_STATE subtype is used to test the LEDs. You can set them to off state, constantly on, blinking and blinking off state.</p> <h3 id="start-up-routine">Start-up routine</h3> <p>Start-up routine won’t work until total number of LEDs has been specified. To set it, use the following message:</p> <p><strong>F0 00 53 43 01 00 01 00 03 TOTAL_NUMBER_OF_LEDS F7</strong></p> <p>There are currently four routines user can select for start-up:</p> <p><strong>F0 00 53 43 01 00 01 00 05 START_UP_PATTERN F7</strong></p> <p>Pattern can be anything 0-4. Setting pattern to 0 will disable start-up routine.</p> <p>Changing order of LEDs during start-up routine:</p> <p><strong>F0 00 53 43 01 00 08 01 LED_NUMBER LED_START_UP_NUMBER F7</strong></p> <h2 id="more-examples">More examples</h2> <p>There are many more examples listed on <a href="https://github.com/paradajz/OpenDeck/tree/master/examples">OpenDeck GitHub</a> repository, so feel free to check them out.</p> <h2 id="planned-features">Planned features</h2> <p>At the moment, I am adding support for encoders in OpenDeck software. Due to their unreliability, it’s really tricky to deal with them in software and getting stable values, but I’m working hard on it, and code should be finished soon.</p> <h2 id="demonstration">Demonstration</h2> <p>I recorded a video to show-off all the mentioned features:</p> <iframe width="560" height="315" src="https://www.youtube.com/embed/3T1-x4B77nw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> </div> <!-- Article Tool Boxes --> <div class="article-boxes"> <!-- Tags Box --> <div class="tags-article box"> <span class="title">Tags:</span> <ul class="tag-cloud-box box-content"> </ul> </div> <div id="hyvor-talk-view"></div> <script type="text/javascript"> var HYVOR_TALK_WEBSITE = 4484;
          var HYVOR_TALK_CONFIG = {
            url: 'https://paradajz.github.io//2014/10/09/opendeck-sysex-protocol-stable.html',
            id: '/2014/10/09/opendeck-sysex-protocol-stable'
          }; </script> <script async type="text/javascript" src="//talk.hyvor.com/web-api/embed"></script> </div> </article> </div> </div> </div> </div> </section> <!-- Site Footer --> <footer class="site-footer" id="footer"> <div class="container"> <div class="row"> <div class="col-md-6 col-md-push-3 footer-info text-center"> <div class="footer-logo"> <img src="/images/logo.svg" width="700"> </div> <div class="footer-info-text"> <p></p> </div> <div class="social-icons"> <ul class="icons"> <li><a href="https://youtube.com/shanteacontrols" target="_blank"><i class="fi flaticon-youtube"></i></a></li> <li><a href="https://www.facebook.com/shanteacontrolsmidi" target="_blank"><i class="fi flaticon-facebook"></i></a></li> </ul> </div> </div> <div class="col-md-8 col-md-push-2 footer-copyright"> <div class="footer-text text-center"> <p>All Rights Reserved</p> <p><a href="https://shanteacontrols.com/">Shantea Controls</a> &copy; 2021</p> </div> </div> </div> </div> </footer> <!-- Go To Top Button --> <a href="#home" class="go-to-top-button"><i class="pe-7s-angle-up"></i></a> <!-- Importing Scripts --> <!-- jQuery CDN --> <script src="//ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script> <!-- If CDN fails than use local jQuery --> <script>window.jQuery || document.write('<script src="/js/jquery-3.0.0.min.js"><\/script>')</script> <!-- Owl Carousel --> <script src="/js/carousel.min.js" charset="utf-8"></script> <!-- Parallaxing & SmoothScroll --> <script src="/js/scrollax.min.js" charset="utf-8"></script> <!-- Main JS --> <script src="/js/main.js" charset="utf-8"></script> </body> </html> 