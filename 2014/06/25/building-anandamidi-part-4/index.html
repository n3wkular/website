<!DOCTYPE html > <html lang="en-US"> <!-- Site Head --> <head> <meta charset="utf-8"> <title>Shantea Controls &#8226 Building Anandamidi, part 4</title> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="shortcut icon" href="/images/favicon.png" title="Favicon"> <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet"> <!-- Importing Styles --> <link rel="stylesheet" href="/css/style.css"> <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.1.7/css/lightgallery-bundle.min.css"> <style> .markdown-body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 auto;
      padding: 45px;
    }
  
    @media (max-width: 767px) {
      .markdown-body {
        padding: 15px;
      }
    } </style> </head> <body> <!-- Page Loader --> <div id="page-loader" class="page-loader"><span class="load-icon"></span></div> <!-- Site Header --> <header class="site-header blog-header parallax" id="home" data-scrollax-parent="true"> <!-- Parallax Header Image --> <div class="parallax-wrapper"> <div class="cover" data-scrollax="properties: { 'translateY': '48%' }"> <img style="min-width: 100%;" src="/images/blog/header.jpg"> </div> </div> <div class="container"> <!-- Site Navigation Bar --> <div class="row site-navigation-bar parent"> <!-- Logo --> <div class="col-sm-2 col-xs-4 logo child-center-v"> <a href="/index.html"><img src="/images/logo_notext.svg" width="70"></a> </div> <!-- Toggle Mobile Menu --> <div class="col-xs-8 toggle-menu child-center-v"> <!-- Burger --> <div class="navTrigger"> <i></i><i></i><i></i> </div> </div> <!-- Navigation Bar --> <div class="col-sm-10 col-xs-12 navigation-bar child-center-v"> <!-- Navigation Menu --> <nav id="navMenu" class="nav-menu"> <ul class="menu"> <li><a href="/#about">ABOUT</a></li> <li><a href="/#features">FEATURES</a></li> <li><a href="/#parallax-features">SPECS</a></li> <li><a href="/#portfolio">GALLERY</a></li> <li><a href="/#testimonials">TESTIMONIALS</a></li> <li class="current-menu-item"><a href="/blog">BLOG</a></li> <li><a href="/#prices">OFFERS</a></li> <li><a href="/#contact">CONTACT</a></li> </ul> </nav> </div> </div> <!-- Site Header Banner --> <div class="row header-banner parent" data-scrollax="properties: { 'translateY': '48%', 'opacity': '1.4' }"> <div class="heading-content text-center child-center-v"> <!-- Heading Title --> <div class="row heading-title"> <h2>Shantea Controls</h2> <hr class="small"> <h1 class="thin">Building Anandamidi, part 4</h1> </div> </div> </div> </div> </header> <!-- Page Section --> <section class="site-section blog-section page-layout" id="start"> <div class="container"> <!-- Page Layout --> <div class="row"> <!-- Sidebar --> <div class="col-md-4 hidden-xs hidden-sm"> <!-- Site Sidebar --> <aside class="site-sidebar"> <!-- Categories Widget --> <div class="widget categories-widget"> <!-- Widget Header --> <header class="widget-header"> <h4 class="widget-title">Categories</h4> </header> <!-- Widget Content --> <div class="widget-content"> <ul class="categories-box"> <li><a href="/category/info">info <span class="cat-count">9</span></a></li> <li><a href="/category/design">design <span class="cat-count">7</span></a></li> <li><a href="/category/build-log">build-log <span class="cat-count">9</span></a></li> <li><a href="/category/development">development <span class="cat-count">21</span></a></li> <li><a href="/category/programming">programming <span class="cat-count">5</span></a></li> </ul> </div> </div> </aside> </div> <!-- Content --> <div class="col-md-8 blog-articles-container"> <!-- Blog Article --> <div class="post-full"> <article class="blog-article blog-single-page clearfix"> <!-- Article Header --> <!-- Article Content --> <article class="markdown-body"> <p>This is the last post about Anandamidi, I promise! So, in case you forgot, this is the remaining stuff to finish the controller:</p> <ol> <li>Painting the case</li> <li>Interfacing Arduino with separate USB MIDI chip on separate PCB (<a href="http://www.altmustech.com/au-123.html">Altmustech AU-123</a>)</li> </ol> <h2 id="painting-the-case">Painting the case</h2> <p>Fairly easy part. I’ve simply bought black spray for wood and sprayed the case 3-4 times. Looks really cool!</p> <p><img src="/images/blog/p6030151.jpg" alt=""></p> <p>Thing I haven’t mentioned before is the cable plate and the cable itself. I bought several of these USB cables off eBay:<img src="/images/blog/p1010041.jpg" alt=""></p> <p>I’ve cut off the mini-b part of cable and replaced it with 4 cables with female headers on them, so that I can simply plug it to USB MIDI or serial conversion board. Since just screwing that cable directly on wooden case would look rather ugly, I’ve also designed a cable plate board, made from same Gravoply board as the main plate.</p> <p><img src="/images/blog/p6050161.jpg" alt="">Much nicer, although I’m not too happy with screws on that plate (I haven’t had anything else). Right, let’s move on to #2.</p> <h2 id="usb-midi-board">USB MIDI board</h2> <p><img src="/images/blog/p1010012.jpg" alt="">There were more than several issues with this thing, as usual. After I received the PCBs, I asked a friend to help me solder that MIDI chip, since I’ve never soldered SMD component before, plus I don’t have necessary equipment for that job. After we soldered everything, connecting the board to PC did nothing. No errors, no anything. Checked everything few times, but I couldn’t find the error. Grrr! Since that didn’t work, I’ve decided to give the controller to the guy for whom I was building it without that board. Instead, there’s simple CP2102 serial module inside the Anandamidi at the moment. Everything is the same, except that way you need to install drivers (atleast if you’re on Windows), install virtual midi port and an app which converts serial messages from Arduino to MIDI. Couple of extra unnecessary layers, but it works without issues. After I got home, I spent few more days trying to figure out where I did mistake. Eventually, I figured I used capacitors far too large to be put in parallel with 12MHz crystal which MIDI chip needs. I bought 22µF tantalum caps, simply because the official documentation said only “22” for two crystal caps, so I assumed they meant microfarads. Did I mention how expensive tantalum caps are? Very. Tantalum caps are very expensive. Oh well. What I needed was 22pF caps, so after I bought them, suddenly everything worked. Hooray! Windows happily reported it found new USB MIDI device. Awesome. Unfortunately, issues didn’t end here.</p> <h3 id="testing-the-board">Testing the board</h3> <p>For first try, I only connected TX pin from Arduino to RX pin to that board, so I was only able to send data from Arduino to PC. It worked without any issue whatsoever, so I assumed sending MIDI data to that chip would work as well. Wrong. I’ve tried to send some  MIDI messages to Arduino via that chip, only to get some gibberish values. Checked everything more than dozen of times, didn’t find anything wrong. So, I went back to reading the AU-123 documentation (after things don’t work, RTFM, right?) and noticed something interesting:</p> <p><img src="/images/blog/screenshot022.png" alt=""></p> <p>Active high? What the hell is that? Apparently, pins on microcontrollers can be either active high or active low. Active high means that HIGH signal (usually +5V) represents binary 1 and vice versa. Active low is exactly the opposite: +5V signal represents binary 0 and 0V represents binary 1. After some more investigation, I learned that USART pins on AVRs are active low, meaning that I need inverter if I want to interface them with active high signals. That was also the reason I got gibberish value on Arduino end without the inversion. Obviously, there’s more than several ways to invert digital signal. First I tried with NAND gates (74HCT00 chip) - worked! I simply connected one input of single NAND gate to +5V, and other input was the TX pin from AU-123 chip. Output from gate was inverted, so I connected it directly to Arduino RX pin. While this solution works, that chip contains 4 NAND gates and has 16 pins, and I only need one input on gate, so it’s a waste of chip. Instead, I went with transistor solution (2n2222):</p> <p><img src="/images/blog/9102.jpg" alt=""></p> <p>Really simple schematic and works just like the NAND gate solution. Finally, the MIDI USB board is fully fuctional.</p> <h2 id="controller-demo">Controller demo</h2> <p>Since everything works, here’s a video with Anandamidi, and my first controller, Tannin. Note that this was recorded before the case was painted. Enjoy.</p> <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/B0tTqctuLCI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> </article> <!-- Article Tool Boxes --> <div class="article-boxes"> <!-- Tags Box --> <div class="tags-article box"> <span class="title">Tags:</span> <ul class="tag-cloud-box box-content"> <li><a href="/tag/anandamidi">anandamidi</a></li> <li><a href="/tag/arduino">arduino</a></li> <li><a href="/tag/case">case</a></li> <li><a href="/tag/midi">midi</a></li> <li><a href="/tag/pcb">pcb</a></li> </ul> </div> </div> </article> </div> </div> </div> </div> </section> <!-- Site Footer --> <footer class="site-footer" id="footer"> <div class="container"> <div class="row"> <div class="col-md-6 col-md-push-3 footer-info text-center"> <div class="footer-logo"> <img src="/images/logo.svg" width="700"> </div> <div class="footer-info-text"> <p></p> </div> <div class="social-icons"> <ul class="icons"> <li><a href="https://youtube.com/shanteacontrols" target="_blank"><i class="fi flaticon-youtube"></i></a></li> <li><a href="https://www.facebook.com/shanteacontrolsmidi" target="_blank"><i class="fi flaticon-facebook"></i></a></li> </ul> </div> </div> <div class="col-md-8 col-md-push-2 footer-copyright"> <div class="footer-text text-center"> <p>All Rights Reserved</p> <p><a href="https://shanteacontrols.com/">Shantea Controls</a> &copy; 2021</p> </div> </div> </div> </div> </footer> <!-- Go To Top Button --> <a href="#home" class="go-to-top-button"><i class="pe-7s-angle-up"></i></a> <!-- Importing Scripts --> <!-- jQuery CDN --> <script src="//ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script> <!-- If CDN fails than use local jQuery --> <script>window.jQuery || document.write('<script src="/js/jquery-3.0.0.min.js"><\/script>')</script> <!-- Owl Carousel --> <script src="/js/carousel.min.js" charset="utf-8"></script> <!-- Parallaxing & SmoothScroll --> <script src="/js/scrollax.min.js" charset="utf-8"></script> <!-- Main JS --> <script src="/js/main.js" charset="utf-8"></script> <!-- LightGallery --> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.1.7/lightgallery.umd.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.1.7/plugins/thumbnail/lg-thumbnail.umd.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.1.7/plugins/zoom/lg-zoom.umd.min.js"></script> <script type="text/javascript"> lightGallery(document.getElementById('gallery-container'), {
        plugins: [lgThumbnail],
        speed: 250,
        licenseKey: "xAIQA"
    }); </script> </body> </html> 